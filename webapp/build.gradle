apply plugin: 'war'

configurations {
    bootstrap
    compile.extendsFrom bootstrap
}

dependencies {
    bootstrap 'org.eclipse.jetty:jetty-server:8.0.4.v20111024'
    bootstrap 'org.eclipse.jetty:jetty-servlet:8.0.4.v20111024'
    bootstrap 'org.eclipse.jetty:jetty-io:8.0.4.v20111024'
    bootstrap 'org.eclipse.jetty:jetty-util:8.0.4.v20111024'
    bootstrap 'org.eclipse.jetty:jetty-webapp:8.0.4.v20111024'

    compile 'org.jruby:jruby-complete:1.6.7.2'
    compile 'org.jruby.rack:jruby-rack:1.1.7'

    compile name: 'gems'
}

sourceSets {
    main {
        resources {
            srcDir 'src/main/ruby'
        }
    }
}

war {
    from configurations.bootstrap.collect { it.isDirectory() ? it : zipTree(it) } + files(sourceSets.main.output.classesDir)
    classpath = runtimeClasspath - configurations.bootstrap
    manifest {
        attributes 'Main-Class': 'gemjar.WebServer'
    }
}

artifacts {
    war
}

task(run, type: JavaExec, dependsOn: 'war') {
    main 'gemjar.WebServer'
    classpath war.archivePath
}
